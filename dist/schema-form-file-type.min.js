/*! leclub-ajf-upload 2015-03-06 */
"use strict";function validateExtension(a,b){for(var c=a.split(".").pop(),d=0;d<b.length;d++)if(b[d]===c)return!0;return!1}var ngSchemaFormFileType=angular.module("ngSchemaFormFileType",["angularFileUpload"]);angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(a,b){b.addMapping("bootstrapDecorator","files","files.html");var c=function(a,b){if("array"===b.type&&"files"===b.format){var c={title:"image",type:"object",properties:{token:{title:"token",type:"string"},extension:{title:"Extension",type:"string",allowed_extensions:[""]},size:{title:"Size",type:"number",max_size:1e7}}};c.properties.extension.allowed_extensions=b.allowed_extensions,c.properties.size.max_size=b.max_size,b.items=c}};a.defaults.array.unshift(c)}]),tv4.defineError("ALLOWED_EXTENSIONS_ERROR",1e4,"Wrong file extension. Allowed extensions are {allowedExtensions}."),tv4.defineKeyword("allowed_extensions",function(a,b){return void 0==b||""==b||"string"!=typeof a?null:validateExtension(a,b)?null:{code:tv4.errorCodes.ALLOWED_EXTENSIONS_ERROR,message:{allowedExtensions:b.join(", ")}}}),tv4.defineError("MAX_SIZE_ERROR",10001,"This file is too large. Maximum size allowed is {maxSize}."),tv4.defineKeyword("max_size",function(a,b){return void 0==b||""==b||"number"!=typeof a?null:b>a?null:{code:tv4.errorCodes.MAX_SIZE_ERROR,message:{fileName:a,maxSize:b}}}),ngSchemaFormFileType.directive("ngSchemaFile",["$upload","$timeout",function(a,b){return{restrict:"A",scope:!0,require:"ngModel",link:function(c){c.fileReaderSupported=null!=window.FileReader&&(null==window.FileAPI||0!=FileAPI.html5),c.upload=function(d){var e=c.form.key[0];c.model[e]=[];for(var f=0;f<d.length;f++){var g=d[f];c.generateThumb(g);var h=g.name.split(".").pop();c.model[e].push({token:f.toString(),extension:h,size:g.size}),g.size>c.form.schema.max_size||!validateExtension(g.name,c.form.schema.allowed_extensions)||a.upload({url:c.form.endpoint,file:g,fields:{index:f}}).progress(function(a){var b=parseInt(100*a.loaded/a.total);a.config.file.filesProgress=b}).success(function(a){c.model[e][a.index]={token:a.token,extension:a.extension,size:a.size}})}b(function(){c.$broadcast("schemaFormValidate")},100)},c.generateThumb=function(a){null!=a&&c.fileReaderSupported&&a.type.indexOf("image")>-1&&b(function(){var c=new FileReader;c.readAsDataURL(a),c.onload=function(c){b(function(){a.dataUrl=c.target.result})}})},c.deleteFile=function(a,d){a.splice(d,1),b(function(){c.$broadcast("schemaFormValidate")},100)}}}}]);
angular.module('ngSchemaFormFileType').run(['$templateCache', function($templateCache) {  'use strict';

  $templateCache.put('files.html',
    "<style type=\"text/css\">.file-objects .form-control-feedback,.file-objects label,.file-objects legend,.file-objects input {display: none;}.noProgressTransition {transition: none;}</style><div ng-schema-file ng-model=\"$$value$$\" class=\"file-objects\"><div sf-array=\"form\" class=\"schema-form-array {{form.htmlClass}}\" ng-model=\"$$value$$\" ng-model-options=\"form.ngModelOptions\"><h3 ng-show=\"form.title && form.notitle !== true\">{{ form.title }}</h3><div class=\"btn btn-default\" ng-model=\"files\" ng-file-select ng-file-change=\"upload($files)\" ng-multiple=\"!(form.schema.minItems == 1 && form.schema.maxItems == 1)\">{{ form.button_label }}</div><ol class=\"list-group\" ng-model=\"modelArray\" ui-sortable style=\"margin-top: 20px\"><li class=\"list-group-item {{form.fieldHtmlClass}}\" ng-repeat=\"item in modelArray track by $index\"><button ng-hide=\"form.readonly\" ng-click=\"deleteFromArray($index); deleteFile(files, $index);\" style=\"position: relative; z-index: 20\" type=\"button\" class=\"close pull-right\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button><div class=\"media-left\"><img class=\"media-object\" ng-src=\"{{files[$index].dataUrl}}\" alt=\"\" style=\"max-width: 100px\" ng-if=\"files[$index].dataUrl\"></div><h5>{{ files[$index].name }} {{ $index }}</h5><div class=\"progress\" style=\"height: 20px\"><div class=\"progress-bar progress-bar-success\" role=\"progressbar\" aria-valuenow=\"{{ files[$index].filesProgress }}\" aria-valuemin=\"0\" aria-valuemax=\"100\" ng-class=\"files[$index].filesProgress==100?'noProgressTransition':''\" style=\"width: {{ files[$index].filesProgress }}%\">{{ files[$index].filesProgress }}% Complete (success)</div></div><sf-decorator ng-init=\"arrayIndex = $index\" form=\"copyWithIndex($index)\"></sf-decorator></li></ol><div class=\"help-block\" style=\"color: #e74c3c\" ng-show=\"(hasError() && errorMessage(schemaError())) || form.description\" ng-bind-html=\"(hasError() && errorMessage(schemaError())) || form.description\"></div></div></div>"
  );
}]);